<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Post a Community Event</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root {
  --bg:#f7f7fb; --card:#ffffff; --accent:#4f46e5; --accent-dark:#3730a3;
  --text:#111; --muted:#6b7280; --border:#d1d5db;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);padding:20px;}
h1{font-size:1.6rem;color:var(--accent-dark);margin-bottom:1rem;}
form{max-width:640px;margin:0 auto;display:flex;flex-direction:column;gap:1rem;}
label{display:flex;flex-direction:column;font-size:0.9rem;color:#333;}
input[type=text],input[type=datetime-local],input[type=number],textarea,select{padding:8px;border:1px solid var(--border);border-radius:6px;font-size:1rem;margin-top:4px;}
textarea{resize:vertical;}
.checkbox-group,.radio-group,.vibe-group{display:flex;flex-wrap:wrap;gap:8px;}
.checkbox-group label,.radio-group label,.vibe-group label{flex:1 1 45%;display:flex;align-items:center;}
.checkbox-group input,.radio-group input{margin-right:6px;}
input[type=file]{margin-top:6px;}
.image-preview{max-width:100%;height:auto;border-radius:6px;margin-top:6px;}
button{padding:10px 16px;border:none;border-radius:8px;font-size:1rem;cursor:pointer;}
button.submit{background:var(--accent);color:#fff;}
button.reset{background:transparent;border:1px solid var(--muted);color:var(--muted);}
.form-footer{display:flex;justify-content:flex-end;gap:10px;}
@media(max-width:480px){.checkbox-group label,.radio-group label,.vibe-group label{flex:1 1 100%;}}

/* tag colors for target community categories */
.tag {display:inline-block;padding:4px 8px;border-radius:8px;margin:2px;font-size:0.8rem;color:#fff;}
.tag-gender{background:#6b7280;}
.tag-identity{background:#10b981;}
.tag-academic{background:#3b82f6;}
.tag-interest{background:#f59e0b;}

/* category text input spacing */
}.category-item {display:flex; flex-direction:column; margin-bottom:20px;}
.category-input {margin-left:24px; margin-top:2px; width:calc(100% - 24px); padding:4px;}

/* safe space label alignment fix if needed */
.safe-space-label {display:flex; align-items:center;}
.safe-space-label input {margin-right:4px;}
</style>
</head>
<body>

<h1>Post a Community Event</h1>

<form id="eventForm" novalidate>
  <label for="eventName">Event name<span aria-hidden="true" style="color:red">*</span>
    <input id="eventName" name="eventName" type="text" required>
  </label>

  <label for="host">Host / organization
    <input id="host" name="host" type="text">
  </label>

  <label for="linkedSpace">Linked Thirdspace
    <select id="linkedSpace" name="linkedSpace">
      <option value="">-- choose or start typing --</option>
      <!-- placeholder options; populate dynamically if you have data -->
      <option value="Cafe Commons">Cafe Commons</option>
      <option value="Riverside Park">Riverside Park</option>
    </select>
  </label>

  <div style="display:flex;gap:8px;flex-wrap:wrap;">
    <label for="startTime" style="flex:1 1 45%;">Start date/time<span aria-hidden="true" style="color:red">*</span>
      <input id="startTime" name="startTime" type="datetime-local" required>
    </label>
    <label for="endTime" style="flex:1 1 45%;">End date/time<span aria-hidden="true" style="color:red">*</span>
      <input id="endTime" name="endTime" type="datetime-local" required>
    </label>
  </div>

  <label for="frequency">Frequency
    <select id="frequency" name="frequency">
      <option value="one-time">One‑time</option>
      <option value="weekly">Weekly</option>
      <option value="monthly">Monthly</option>
    </select>
  </label>

  <div class="checkbox-group">
    <label><input type="checkbox" id="freeToggle" name="freeToggle" value="free"> Free event</label>
    <label><input type="number" id="cost" name="cost" min="0" placeholder="Ticket price" step="0.01"></label>
  </div>

  <fieldset>
    <legend>Event type</legend>
    <div class="radio-group">
      <label><input type="radio" name="type" value="study" checked> Study / co‑working</label>
      <label><input type="radio" name="type" value="arts"> Arts / music</label>
      <label><input type="radio" name="type" value="social"> Social / mixer</label>
      <label><input type="radio" name="type" value="workshop"> Workshop</label>
      <label><input type="radio" name="type" value="fitness"> Fitness</label>
    </div>
  </fieldset>

  <fieldset>
    <legend>Atmosphere</legend>
    <div class="checkbox-group">
      <label><input type="checkbox" name="vibe" value="quiet"> Quiet</label>
      <label><input type="checkbox" name="vibe" value="high-energy"> High‑energy</label>
      <label><input type="checkbox" name="vibe" value="beginner-friendly"> Beginner‑friendly</label>
      <label><input type="checkbox" name="vibe" value="student-only"> Student‑only</label>
    </div>
  </fieldset>

  <!-- target community / inclusivity (updated UI) -->
  <fieldset>
    <legend>Who is this for?<br><small>Help people find their community.</small></legend>
    <div class="checkbox-group" id="targetCheckboxes">
      <div class="category-item">
        <label><input type="checkbox" class="cat-checkbox" value="Gender-Based" data-category="gender"> Gender-Based</label>
        <input class="category-input" data-cat="Gender-Based" type="text" placeholder="e.g. Women-only, Non-binary/Trans" style="display:none;" />
      </div>
      <div class="category-item">
        <label><input type="checkbox" class="cat-checkbox" value="Identity-Based" data-category="identity"> Identity-Based</label>
        <input class="category-input" data-cat="Identity-Based" type="text" placeholder="e.g. LGBTQ+, BIPOC, Int'l students" style="display:none;" />
      </div>
      <div class="category-item">
        <label><input type="checkbox" class="cat-checkbox" value="Academic/Career" data-category="academic"> Academic/Career</label>
        <input class="category-input" data-cat="Academic/Career" type="text" placeholder="e.g. Economics, STEM, Creatives" style="display:none;" />
      </div>
      <div class="category-item">
        <label><input type="checkbox" class="cat-checkbox" value="Interests" data-category="interest"> Interests</label>
        <input class="category-input" data-cat="Interests" type="text" placeholder="e.g. Gaming, Book club" style="display:none;" />
      </div>
      <div class="category-item">
        <label><input type="checkbox" class="cat-checkbox" value="Other" data-category="other"> Other</label>
        <input class="category-input" data-cat="Other" type="text" placeholder="Describe other community" style="display:none;" />
      </div>
    </div>
    <div id="selectedTags" style="margin-top:6px;"></div>

    <div style="margin-top:8px;">
      <label class="safe-space-label"><input type="checkbox" id="safeSpace" name="safeSpace"> Safe Space (will moderate for inclusivity)</label>
    </div>
    <div style="margin-top:8px;">
      <label>Access level:
        <select id="accessLevel" name="accessLevel">
          <option value="open">Open to All</option>
          <option value="exclusive">Exclusive to Target Community</option>
        </select>
      </label>
    </div>
    <label for="requirements" id="reqLabel" style="display:none; margin-top:8px;">
      Specific Entry Requirements
      <input type="text" id="requirements" name="requirements" placeholder="e.g. Must be a member of X club">
    </label>
  </fieldset>

  <label for="description">Description
    <textarea id="description" name="description" rows="4"></textarea>
  </label>

  <label for="cta">Call to action (URL)
    <input id="cta" name="cta" type="text" placeholder="RSVP link, Instagram post...">
  </label>

  <label for="imageUpload">Event image / flyer
    <input id="imageUpload" name="imageUpload" type="file" accept="image/*">
    <img id="imagePreview" class="image-preview" aria-hidden="true">
  </label>

  <div class="form-footer">
    <button type="reset" class="reset">Reset</button>
    <button type="submit" class="submit">Post event</button>
  </div>
</form>

<script>
const imageInput = document.getElementById('imageUpload');
const preview = document.getElementById('imagePreview');
imageInput.addEventListener('change', e => {
  const file = e.target.files[0];
  if (file) {
    preview.src = URL.createObjectURL(file);
    preview.style.display = 'block';
  } else {
    preview.src = '';
    preview.style.display = 'none';
  }
});

// helper to get selected community values (category or custom text)
function getSelectedTargets() {
  return Array.from(document.querySelectorAll('.cat-checkbox:checked')).map(cb => {
    const cat = cb.value;
    const input = document.querySelector(`.category-input[data-cat="${cat}"] input`);
    const custom = input && input.value.trim();
    return custom || cat;
  });
}

// show/hide custom input when checkbox toggles
document.querySelectorAll('.cat-checkbox').forEach(cb => {
  cb.addEventListener('change', () => {
    const cat = cb.value;
    const wrapper = document.querySelector(`.category-input[data-cat="${cat}"]`);
    if (wrapper) wrapper.style.display = cb.checked ? 'block' : 'none';
    updateTags();
  });
});

// render tags beneath selections
function updateTags() {
  const container = document.getElementById('selectedTags');
  container.innerHTML = '';
  document.querySelectorAll('.cat-checkbox:checked').forEach(cb=>{
    const cat = cb.dataset.category || '';
    const catName = cb.value;
    const input = document.querySelector(`.category-input[data-cat="${catName}"] input`);
    const label = input && input.value.trim() ? input.value.trim() : catName;
    const span = document.createElement('span');
    span.textContent = label;
    span.className = `tag tag-${cat}`;
    container.appendChild(span);
  });
  // show requirements input if any target chosen
  document.getElementById('reqLabel').style.display = document.querySelectorAll('.cat-checkbox:checked').length ? 'block' : 'none';
}

// initialize tags and input visibility on load
updateTags();
// also ensure inputs visibility corresponds to checked state
document.querySelectorAll('.cat-checkbox').forEach(cb => {
  const cat = cb.value;
  const wrapper = document.querySelector(`.category-input[data-cat="${cat}"]`);
  if (wrapper) wrapper.style.display = cb.checked ? 'block' : 'none';
});
// update tags when custom label changes
document.querySelectorAll('.category-input input').forEach(inp=>{
  inp.addEventListener('input', updateTags);
});

// access level/requirements logic
const accessEl = document.getElementById('accessLevel');
accessEl.addEventListener('change', () => {
  // nothing extra needed; visibility handled in updateTags
});

// submit listener
document.getElementById('eventForm').addEventListener('submit', function(e){
  e.preventDefault();
  const f = e.target;
  if (f.endTime.value && f.startTime.value && f.endTime.value <= f.startTime.value) {
    alert('End time must be after the start time.');
    return;
  }
  if (!f.checkValidity()) {
    f.reportValidity();
    return;
  }
  const data = {
    eventName: f.eventName.value.trim(),
    host: f.host.value.trim(),
    linkedSpace: f.linkedSpace.value,
    startTime: f.startTime.value,
    endTime: f.endTime.value,
    frequency: f.frequency.value,
    cost: f.freeToggle.checked ? 0 : parseFloat(f.cost.value) || 0,
    free: f.freeToggle.checked,
    type: f.type.value,
    vibe: Array.from(f.elements['vibe'])
             .filter(i=>i.checked).map(i=>i.value),
    description: f.description.value.trim(),
    cta: f.cta.value.trim(),
    imageFile: f.imageUpload.files[0]?.name || null,
    // new inclusivity fields
    target_communities: getSelectedTargets(),
    safe_space: f.safeSpace.checked,
    accessLevel: f.accessLevel.value,
    requirements: f.requirements?.value.trim() || '',
    postedAt: new Date().toISOString()
  };
  console.log('event submission', JSON.stringify(data,null,2));
  alert('Event logged in console (ready for POST).');
  f.reset();
  preview.src = '';
  preview.style.display = 'none';
  updateTags(); // clear tags
});
</script>

</body>
</html>